<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="manifest" href="manifest.json">
    <title>ようこそ、jigインターンへ！</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
      }
      html, body {
        height: 100vh;
        width: 100%;
      }
      body {
        display: grid;
        place-content: center;
      }
    </style>
    <script type="module">
      const message = await fetch("/welcome-message")
      //document.querySelector("body").innerHTML = `<h1>${await message.text()}</h1>`
    </script>
  </head>
  <body>
    <!--- 送信用フォーム --->
    <p></p>
    <input id="fromID">　コメ主ID</input>
    <p></p>
    <input id="spNO">　コメント番号(連番)</input>
    <!---ここは後でスクリプトから決定するようにする。DBに連番を保存して+1を入れる--->
    <p></p>
    <input id="userID">　送信先ユーザーID(コメ主ID)</input>
    <p></p>
    <textarea rows="10" cols="50" name="comment" id="mainTextI">ここに初期テキストを入力できます(オプション)</textarea>
    <p></p>
    <button id="sp_send_button">SP送信</button>
    <button id="sp_delete_button">SP削除</button>
    <button id="sp_getall_button">SP全件取得</button>
  
    <!--- 受信したときのテキスト --->
    <p id="user">送信先ユーザー名が表示されます。</p>
    <p id="time">送信時間が表示されます。</p>
    <p id="mainText">送信したテキストが表示されます。</p>
    <!---<button id="user_DB_Get_ID">ID新規取得とローカルストレージに保存</button>--->
    <p id="user_ID">IDが表示されます。</p>
  
    <!--- JSスクリプト --->
    <script type="module">
     window.onload = async (event) => {
       // GET /shiritoriを実行
       const response = await fetch("/get_myId_DB", { method: "POST" });
       // responseの中からレスポンスのテキストデータを取得
       const myId = await response.text();
       // id: previousWordのタグを取得
       const myID = document.querySelector("#user_ID");
       // 取得したタグの中身を書き換える
       myID.innerHTML = `yourID: ${myId}`;
     }

      //SP送信ボタンが送られたら
      document.getElementById("sp_send_button").onclick = async () => {
        // inputタグを取得.中身を取得
        const fromID = document.querySelector("#fromID").value;
        // inputタグを取得.中身を取得
        const spNO = document.querySelector("#spNO").value;
        // inputタグを取得.中身を取得
        const sendId = document.querySelector("#userID").value;
        //ここに　　localStorage.getItem('key');
        //でユーザIDを取得し「sendId」にその値を代入すればローカルストレージのIDでSPを投稿可能になります。
        
        // inputタグを取得.中身を取得
        const sendText = document.querySelector("#mainTextI").value;
  
        const response = await fetch("/add_DB_SP",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ 
              fromID,
              spNO,
              sendId,
              "time" : getCurrentDateTime(),
              sendText
            })
          });
        
        //何を送信しようとしたかUIでかくにんするコード三つ。
        document.getElementById("user").innerText = sendId;//await response.text();
        document.getElementById("time").innerText = getCurrentDateTime();
        document.getElementById("mainText").innerText = sendText;
      };

      //削除ボタンが押されたら
      document.getElementById("sp_delete_button").onclick = async () => {
        // inputタグを取得、中身を取得
        const deleteId = document.querySelector("#userID").value;
  
        const response = await fetch("/delete_DB_SP",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ deleteId　})
  
          });
        
        //何を送信しようとしたかUIでかくにんするコード三つ。
        document.getElementById("user").innerText = deleteId;//await response.text();
        document.getElementById("time").innerText = getCurrentDateTime();
        document.getElementById("mainText").innerText = "SPの削除を試みました";
      };
  
      //SPゲットボタンが押されたら
      document.getElementById("sp_getall_button").onclick = async () => {
        const response = await fetch("/getAll_DB_SP",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            //body: JSON.stringify({ deleteId　})
          });
        
        //何を送信しようとしたかUIでかくにんするコード三つ。
        document.getElementById("user").innerText = deleteId;//await response.text();
        document.getElementById("time").innerText = getCurrentDateTime();
        document.getElementById("mainText").innerText = "SPの全件取得を試みました";
      };

      function getCurrentDateTime() {
        const now = new Date();
  
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
  
        return `${year}${month}${day}${hours}${minutes}${seconds}`;
      }

      //const now = new Date(); // 現在の日付と時刻を取得
      //const hours = now.getHours(); // 時間を取得
      //const minutes = now.getMinutes(); // 分を取得
      //const seconds = now.getSeconds(); // 秒を取得
    </script>

    <script src="/permission.js"></script>
  </body>
</html>
