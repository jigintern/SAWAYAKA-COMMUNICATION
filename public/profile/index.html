<!DOCTYPE html>
<html lang="ja">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
  <link rel="stylesheet" href="/styles/components.css">
  <link rel="stylesheet" href="/styles/profile.css">
  <link href="https://use.fontawesome.com/releases/v62.0/css/all.css" rel="stylesheet">
  <script src="/lib/sessionChecker.js"></script>
  <title>profile_page</title>
</head>

<body>
  <div id="header"></div>
  <main>
    <!--ユーザー情報表示カード-->
    <div id="user_content_card">
      <div id="user_header_area">
        <div id="user_name">
          <p id="user_nick_name">User_Nick_Name</p>
        </div>
      </div>
      <div class="user_data">
        <div id="user_icon_wrapper">
          <div id="user_icon">
            <div id="user_tmp_img"></div>
            <!-- <img src="/icons/lemon.svg" id="user_icon_img" alt="user_icon_img"> -->
          </div>
        </div>
        <div id="SPoint">
          <p><b>500 SP</b></p>
        </div>
        <div id="user_info_area">
          <span id="user_id">ID:123456</span>
          <span id="user_QR_code"><img src="/icons/QR-code.svg" alt=""></span>
        </div>
      </div>
      <!--ユーザー趣味表示部分-->
      <div id="user_hobby_card">
        <div id="hobby_category">
          <p>カテゴリー「音楽」</p>
        </div>
        <div id="hobby_content">
          <p>君が代</p>
        </div>
      </div>
    </div>
    <!--さわやかポイント表示部分-->
    <!--さわやかポイントはSPointと省略しています-->
    <div id="Show_SPoint">

      <p>さわやかポイント</p>
      <ul id="show_SPoints"></ul>
    </div>
  </main>
  <div id="footer"></div>

  <script>
    window.onload = async (event) => {
      const myData = await localStorage.getItem('current_user')
      const ID = Number(JSON.parse(myData).id);//自身のID取得

      const response = await fetch("/get_sp_list", 
      { 
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ 
          ID
        })
      });
      const data = await response.json();
      
     console.log(data);
    //  console.log(await response[0]);
      displayList(data);
    }

    fetch("/components/header.html")
      .then((response) => response.text())
      .then((data) => document.querySelector("#header").innerHTML = data);
    fetch("/components/footer.html")
      .then((response) => response.text())
      .then((data) => document.querySelector("#footer").innerHTML = data);
    // document.getElementById('Search_id_submit_button').addEventListener('click', () => {
    //   const rawid = document.getElementById("Search_id_Input_form");
    // });
    
    
    // リストを表示する関数
    function displayList(fruits) {
      //const fruits = ['りんご', 'バナナ', 'オレンジ', 'ぶどう', 'メロン'];

      const list = document.getElementById('show_SPoints');
      //console.log(fruits.message);
      fruits.forEach(fruit => {
        //console.log("くだもの名 " + fruit);
        const li = document.createElement('li');
        //console.log(fruit.value);
        li.textContent = formatDateTime(String(fruit.value.time)) + " " + fruit.value.mainText;
        list.appendChild(li);
      });
    }

    function formatDateTime(dateTimeString) {
      // 文字列から年、月、日、時、分を抽出
      const year = dateTimeString.substring(0, 4);
      const month = dateTimeString.substring(4, 6);
      const day = dateTimeString.substring(6, 8);
      const hour = dateTimeString.substring(8, 10);
      const minute = dateTimeString.substring(10, 12);

      // フォーマットされた文字列を返す
      return `${year}年${parseInt(month)}月${parseInt(day)}日${hour}時${minute}分`;
    }

    // ページ読み込み時にリストを表示
    // window.onload = displayList;
  </script>
  <script src="/lib/footerLinkModifier.js"></script>
</body>

</html>